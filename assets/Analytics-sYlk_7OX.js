import{g as G,a as j}from"./analyticsService-BUMq7Osh.js";import{g as H}from"./contentService-Ci929EFG.js";import{g as K,S as U}from"./api-DaGFE-z-.js";import{S as Y}from"./StatCard-BeQBHyb9.js";import{L as J}from"./LoadingSpinner-mqVYkIB7.js";import{A as Q,B as W,L as X}from"./BarChart-BW-0n5iN.js";import{_ as Z,I as $,a as d,b as e,f as ee,g as P,h as o,y as h,i as c,t as a,p as w,F as I,e as q,r as C,c as O,x as te,o as i,j as N,n as M}from"./index-D5JU7zdi.js";import"./format-sbWH3_uq.js";const se={name:"Analytics",components:{StatCard:Y,LoadingSpinner:J,LineChart:X,BarChart:W,Icon:$,AIAssistant:Q},setup(){const k=C(!0),t=C({totalStudents:0,totalContent:0,totalActivities:0,avgEngagementRate:0,avgCompletionRate:0,trends:[]}),L=C(""),n=C([]),T=C([]),B=C(null),E=O(()=>({labels:t.value.trends.map(l=>l.date.slice(5)),datasets:[{label:"Activities",data:t.value.trends.map(l=>l.activities),borderColor:"#667eea",backgroundColor:"rgba(102, 126, 234, 0.1)",tension:.4,fill:!0},{label:"Completions",data:t.value.trends.map(l=>l.completions),borderColor:"#43e97b",backgroundColor:"rgba(67, 233, 123, 0.1)",tension:.4,fill:!0}]})),f=O(()=>{const l=t.value.trends.slice(-7);return{labels:l.map(g=>g.date.slice(5)),datasets:[{label:"Unique Students",data:l.map(g=>g.uniqueStudents),backgroundColor:"#667eea"}]}}),r=async()=>{try{k.value=!0;const[l,g]=await Promise.all([G(),j()]);l.success&&(t.value=l.data.summary,L.value=l.data.aiInsight,n.value=l.data.atRiskStudents),g.success&&(B.value=g.data);const S=await H();if(S.success){const D=K(U.EVENTS)||[];T.value=S.data.map(m=>{const u=D.filter(v=>v.contentId===m.id),_=u.length,A=_>0?Math.round(u.reduce((v,s)=>v+s.durationMs/6e4,0)/_):0,R=u.filter(v=>v.completed).length,p=_>0?Math.round(R/_*100):0;let y="good";return p>=80?y="excellent":p<50&&(y="needs improvement"),{id:m.id,title:m.title,type:m.type,difficulty:m.difficulty,views:_,avgTime:A,completionRate:p,performance:y}}).sort((m,u)=>u.views-m.views)}}catch(l){console.error("Failed to load analytics:",l)}finally{k.value=!1}},x=l=>l>=70?"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)":l>=50?"linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%)":"linear-gradient(135deg, #ef4444 0%, #f87171 100%)",b=l=>({beginner:"badge-success",intermediate:"badge-warning",advanced:"badge-danger"})[l]||"badge-info",z=l=>({excellent:"badge-success",good:"badge-info","needs improvement":"badge-warning"})[l]||"badge-info";return te(()=>{r()}),{loading:k,stats:t,aiInsight:L,atRiskStudents:n,contentPerformance:T,engagementData:B,trendsChartData:E,completionChartData:f,getProgressColor:x,getDifficultyClass:b,getPerformanceClass:z}}},ne={class:"analytics"},ae={key:1},le={class:"stats-grid"},oe={class:"card mb-3"},ie={class:"card-header"},de={class:"card-title"},re={class:"alert alert-info"},ce={style:{"font-size":"1.05rem","margin-bottom":"0.5rem"}},ge={class:"mb-3"},me={key:0,class:"card mb-3"},ue={class:"card-header"},_e={class:"card-title"},ve={class:"engagement-grid"},he={class:"engagement-card"},fe={class:"engagement-card-header"},be={class:"engagement-card-body"},pe={class:"engagement-metric"},ye={class:"metric-value"},Ce={class:"engagement-detail"},Se={class:"detail-value"},ke={class:"engagement-card"},De={class:"engagement-card-header"},Ae={class:"engagement-card-body"},Re={class:"engagement-metric"},Pe={class:"metric-value"},we={class:"engagement-detail"},Ie={class:"detail-value"},qe={class:"engagement-card"},Le={class:"engagement-card-header"},Te={class:"engagement-card-body"},Be={class:"engagement-metric"},Ee={class:"metric-value"},xe={key:0,class:"engagement-detail"},ze={class:"detail-value"},Fe={class:"engagement-card"},Ne={class:"engagement-card-header"},Me={class:"engagement-card-body"},Oe={class:"engagement-metric"},Ve={class:"metric-value"},Ge={class:"engagement-detail"},je={class:"detail-value"},He={key:0,class:"engagement-details-section"},Ke={class:"section-subtitle"},Ue={class:"engaged-students-list"},Ye={class:"student-info"},Je={class:"student-activity"},Qe={class:"student-frequency"},We={class:"frequency-bar"},Xe={class:"frequency-text"},Ze={class:"grid grid-2 mb-3"},$e={class:"card"},et={class:"card-header"},tt={class:"card-title"},st={class:"card"},nt={class:"card-header"},at={class:"card-title"},lt={class:"card mb-3"},ot={class:"card-header"},it={class:"card-title"},dt={class:"badge badge-danger"},rt={key:0,class:"empty-state"},ct={key:1,class:"table-container"},gt={class:"table"},mt={class:"progress-bar-container"},ut={class:"progress-text"},_t={class:"skills-tags"},vt={key:0,class:"skill-tag"},ht={class:"card"},ft={class:"card-header"},bt={class:"card-title"},pt={class:"table-container"},yt={class:"table"},Ct={class:"badge badge-info"},St={class:"progress-bar-container"},kt={class:"progress-text"};function Dt(k,t,L,n,T,B){var g,S,D,m,u,_,A,R,p,y,v;const E=h("LoadingSpinner"),f=h("StatCard"),r=h("Icon"),x=h("AIAssistant"),b=h("router-link"),z=h("LineChart"),l=h("BarChart");return i(),d("div",ne,[t[25]||(t[25]=e("div",{class:"page-header"},[e("div",null,[e("h1",null,"Analytics Dashboard"),e("p",null,"AI-driven insights into student performance and engagement")])],-1)),n.loading?(i(),ee(E,{key:0,message:"Analyzing data..."})):(i(),d("div",ae,[e("div",le,[o(f,{icon:"users",value:n.stats.totalStudents,label:"Total Students",iconBg:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},null,8,["value"]),o(f,{icon:"book",value:n.stats.totalContent,label:"Content Items",iconBg:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"},null,8,["value"]),o(f,{icon:"activity",value:n.stats.totalActivities,label:"Total Activities",iconBg:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"},null,8,["value"]),o(f,{icon:"lightning",value:`${n.stats.avgEngagementRate}%`,label:"Avg Engagement",iconBg:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"},null,8,["value"])]),e("div",oe,[e("div",ie,[e("h3",de,[o(r,{name:"brain"}),t[0]||(t[0]=c(" AI-Generated Insights",-1))])]),e("div",re,[o(r,{name:"info",size:"1.5rem"}),e("div",null,[e("p",ce,a(n.aiInsight),1),t[1]||(t[1]=e("p",{style:{"font-size":"0.9rem",color:"var(--info)",margin:"0"}}," Recommendation: Review at-risk students below and consider personalized interventions. ",-1))])])]),e("div",ge,[o(x)]),n.engagementData?(i(),d("div",me,[e("div",ue,[e("h3",_e,[o(r,{name:"activity"}),t[2]||(t[2]=c(" Engagement Overview",-1))]),o(b,{to:"/reports",class:"btn btn-small btn-primary"},{default:w(()=>[...t[3]||(t[3]=[c("View Full Report",-1)])]),_:1})]),e("div",ve,[e("div",he,[e("div",fe,[o(r,{name:"users",size:"1.5rem",class:"engagement-icon",style:{color:"#667eea"}}),t[4]||(t[4]=e("h4",null,"Active Students",-1))]),e("div",be,[e("div",pe,[e("span",ye,a(((g=n.engagementData.sessionFrequency)==null?void 0:g.length)||0),1),t[5]||(t[5]=e("span",{class:"metric-label"},"students engaged",-1))]),e("div",Ce,[t[6]||(t[6]=e("span",{class:"detail-label"},"Avg Activity Rate:",-1)),e("span",Se,a(Math.round(((S=n.engagementData.sessionFrequency)==null?void 0:S.reduce((s,F)=>s+F.frequencyPercentage,0))/(((D=n.engagementData.sessionFrequency)==null?void 0:D.length)||1)))+"% ",1)])])]),e("div",ke,[e("div",De,[o(r,{name:"trending-up",size:"1.5rem",class:"engagement-icon",style:{color:"#43e97b"}}),t[7]||(t[7]=e("h4",null,"Top Streaks",-1))]),e("div",Ae,[e("div",Re,[e("span",Pe,a(((u=(m=n.engagementData.streaks)==null?void 0:m[0])==null?void 0:u.currentStreak)||0),1),t[8]||(t[8]=e("span",{class:"metric-label"},"days (longest streak)",-1))]),e("div",we,[t[9]||(t[9]=e("span",{class:"detail-label"},"Student:",-1)),e("span",Ie,a(((A=(_=n.engagementData.streaks)==null?void 0:_[0])==null?void 0:A.studentName)||"N/A"),1)])])]),e("div",qe,[e("div",Le,[o(r,{name:"alert",size:"1.5rem",class:"engagement-icon",style:{color:"#f59e0b"}}),t[10]||(t[10]=e("h4",null,"Drop-off Points",-1))]),e("div",Te,[e("div",Be,[e("span",Ee,a(((R=n.engagementData.dropOffPoints)==null?void 0:R.length)||0),1),t[11]||(t[11]=e("span",{class:"metric-label"},"identified points",-1))]),n.engagementData.dropOffPoints&&n.engagementData.dropOffPoints.length>0?(i(),d("div",xe,[t[12]||(t[12]=e("span",{class:"detail-label"},"Highest:",-1)),e("span",ze,a(n.engagementData.dropOffPoints[0].dropOffPercentage)+"% drop",1)])):P("",!0)])]),e("div",Fe,[e("div",Ne,[o(r,{name:"clock",size:"1.5rem",class:"engagement-icon",style:{color:"#3b82f6"}}),t[13]||(t[13]=e("h4",null,"Time Efficiency",-1))]),e("div",Me,[e("div",Oe,[e("span",Ve,a(((p=n.engagementData.timeComparison)==null?void 0:p.filter(s=>s.timeRatio<=1.2&&s.timeRatio>=.8).length)||0),1),t[14]||(t[14]=e("span",{class:"metric-label"},"lessons on pace",-1))]),e("div",Ge,[t[15]||(t[15]=e("span",{class:"detail-label"},"Total Lessons:",-1)),e("span",je,a(((y=n.engagementData.timeComparison)==null?void 0:y.length)||0),1)])])])]),n.engagementData.sessionFrequency?(i(),d("div",He,[e("h4",Ke,[o(r,{name:"star"}),t[16]||(t[16]=c(" Most Consistent Students",-1))]),e("div",Ue,[(i(!0),d(I,null,q((v=n.engagementData.sessionFrequency)==null?void 0:v.slice(0,5),s=>(i(),d("div",{key:s.studentId,class:"engaged-student-item"},[e("div",Ye,[o(b,{to:`/students/${s.studentId}`,class:"student-name"},{default:w(()=>[c(a(s.studentName),1)]),_:2},1032,["to"]),e("span",Je,a(s.activeDays)+" days active",1)]),e("div",Qe,[e("div",We,[e("div",{class:"frequency-fill",style:N({width:s.frequencyPercentage+"%"})},null,4)]),e("span",Xe,a(s.frequencyPercentage)+"%",1)])]))),128))])])):P("",!0)])):P("",!0),e("div",Ze,[e("div",$e,[e("div",et,[e("h3",tt,[o(r,{name:"trending-up"}),t[17]||(t[17]=c(" Activity Trends (Last 7 Days)",-1))])]),o(z,{data:n.trendsChartData},null,8,["data"])]),e("div",st,[e("div",nt,[e("h3",at,[o(r,{name:"chart"}),t[18]||(t[18]=c(" Completion Rates",-1))])]),o(l,{data:n.completionChartData},null,8,["data"])])]),e("div",lt,[e("div",ot,[e("h3",it,[o(r,{name:"warning"}),t[19]||(t[19]=c(" At-Risk Students",-1))]),e("span",dt,a(n.atRiskStudents.length)+" students",1)]),n.atRiskStudents.length===0?(i(),d("div",rt,[e("p",null,[o(r,{name:"check"}),t[20]||(t[20]=c(" No students at risk currently!",-1))])])):(i(),d("div",ct,[e("table",gt,[t[22]||(t[22]=e("thead",null,[e("tr",null,[e("th",null,"Student"),e("th",null,"Grade & Class"),e("th",null,"Risk Level"),e("th",null,"Reason"),e("th",null,"Pass Probability"),e("th",null,"Missing Skills"),e("th",null,"Action")])],-1)),e("tbody",null,[(i(!0),d(I,null,q(n.atRiskStudents,s=>(i(),d("tr",{key:s.student.id},[e("td",null,[o(b,{to:`/students/${s.student.id}`,style:{color:"var(--primary)","font-weight":"600"}},{default:w(()=>[c(a(s.student.name),1)]),_:2},1032,["to"])]),e("td",null,a(s.student.grade)+" - "+a(s.student.class),1),e("td",null,[e("span",{class:M(["badge",s.riskLevel==="high"?"badge-danger":"badge-warning"])},a(s.riskLevel),3)]),e("td",null,a(s.reason),1),e("td",null,[e("div",mt,[e("div",{class:"progress-bar",style:N({width:s.passProbability+"%",background:n.getProgressColor(s.passProbability)})},null,4),e("span",ut,a(Math.round(s.passProbability))+"%",1)])]),e("td",null,[e("div",_t,[(i(!0),d(I,null,q(s.missingSkills.slice(0,2),(F,V)=>(i(),d("span",{key:V,class:"skill-tag"},a(F),1))),128)),s.missingSkills.length>2?(i(),d("span",vt," +"+a(s.missingSkills.length-2),1)):P("",!0)])]),e("td",null,[o(b,{to:`/students/${s.student.id}`,class:"btn btn-small btn-primary"},{default:w(()=>[...t[21]||(t[21]=[c(" View Details ",-1)])]),_:1},8,["to"])])]))),128))])])]))]),e("div",ht,[e("div",ft,[e("h3",bt,[o(r,{name:"book"}),t[23]||(t[23]=c(" Content Performance",-1))])]),e("div",pt,[e("table",yt,[t[24]||(t[24]=e("thead",null,[e("tr",null,[e("th",null,"Content Title"),e("th",null,"Type"),e("th",null,"Difficulty"),e("th",null,"Views"),e("th",null,"Avg Time"),e("th",null,"Completion Rate"),e("th",null,"Performance")])],-1)),e("tbody",null,[(i(!0),d(I,null,q(n.contentPerformance,s=>(i(),d("tr",{key:s.id},[e("td",null,[e("strong",null,a(s.title),1)]),e("td",null,[e("span",Ct,a(s.type),1)]),e("td",null,[e("span",{class:M(["badge",n.getDifficultyClass(s.difficulty)])},a(s.difficulty),3)]),e("td",null,a(s.views),1),e("td",null,a(s.avgTime)+" min",1),e("td",null,[e("div",St,[e("div",{class:"progress-bar",style:N({width:s.completionRate+"%",background:n.getProgressColor(s.completionRate)})},null,4),e("span",kt,a(s.completionRate)+"%",1)])]),e("td",null,[e("span",{class:M(["badge",n.getPerformanceClass(s.performance)])},a(s.performance),3)])]))),128))])])])])]))])}const Bt=Z(se,[["render",Dt],["__scopeId","data-v-3d9ebaed"]]);export{Bt as default};
