import{_ as j,I as H,a as d,b as t,f as O,h as l,g as S,y as h,i as c,t as a,p as D,F as q,e as L,T as K,n as z,r as f,c as V,x as U,o as i,j as M}from"./index-wMkqQ9cd.js";import{g as Y,a as J}from"./analyticsService-BMzfXaLd.js";import{g as Q}from"./contentService-DBdFO2rq.js";import{g as W,S as X}from"./api-D1efx5EC.js";import{S as Z}from"./StatCard-Bf_Gq-TI.js";import{L as $}from"./LoadingSpinner-Bbs66dXJ.js";import{A as tt,B as et,L as st}from"./BarChart-CxDj7zLK.js";import"./format-sbWH3_uq.js";const nt={name:"Analytics",components:{StatCard:Z,LoadingSpinner:$,LineChart:st,BarChart:et,Icon:H,AIAssistant:tt},setup(){const w=f(!0),e=f(!1),v=f({totalStudents:0,totalContent:0,totalActivities:0,avgEngagementRate:0,avgCompletionRate:0,trends:[]}),n=f(""),x=f([]),B=f([]),R=f(null),b=V(()=>({labels:v.value.trends.map(o=>o.date.slice(5)),datasets:[{label:"Activities",data:v.value.trends.map(o=>o.activities),borderColor:"#667eea",backgroundColor:"rgba(102, 126, 234, 0.1)",tension:.4,fill:!0},{label:"Completions",data:v.value.trends.map(o=>o.completions),borderColor:"#43e97b",backgroundColor:"rgba(67, 233, 123, 0.1)",tension:.4,fill:!0}]})),r=V(()=>{const o=v.value.trends.slice(-7);return{labels:o.map(g=>g.date.slice(5)),datasets:[{label:"Unique Students",data:o.map(g=>g.uniqueStudents),backgroundColor:"#667eea"}]}}),p=async()=>{try{w.value=!0;const[o,g]=await Promise.all([Y(),J()]);o.success&&(v.value=o.data.summary,n.value=o.data.aiInsight,x.value=o.data.atRiskStudents),g.success&&(R.value=g.data);const A=await Q();if(A.success){const I=W(X.EVENTS)||[];B.value=A.data.map(m=>{const u=I.filter(s=>s.contentId===m.id),_=u.length,P=_>0?Math.round(u.reduce((s,k)=>s+k.durationMs/6e4,0)/_):0,T=u.filter(s=>s.completed).length,y=_>0?Math.round(T/_*100):0;let C="good";return y>=80?C="excellent":y<50&&(C="needs improvement"),{id:m.id,title:m.title,type:m.type,difficulty:m.difficulty,views:_,avgTime:P,completionRate:y,performance:C}}).sort((m,u)=>u.views-m.views)}}catch(o){console.error("Failed to load analytics:",o)}finally{w.value=!1}},E=o=>o>=70?"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)":o>=50?"linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%)":"linear-gradient(135deg, #ef4444 0%, #f87171 100%)",F=o=>({beginner:"badge-success",intermediate:"badge-warning",advanced:"badge-danger"})[o]||"badge-info",N=o=>({excellent:"badge-success",good:"badge-info","needs improvement":"badge-warning"})[o]||"badge-info";return U(()=>{p()}),{loading:w,showAIAssistant:e,stats:v,aiInsight:n,atRiskStudents:x,contentPerformance:B,engagementData:R,trendsChartData:b,completionChartData:r,getProgressColor:E,getDifficultyClass:F,getPerformanceClass:N}}},at={class:"analytics"},lt={key:1},ot={class:"stats-grid"},it={class:"card mb-3"},dt={class:"card-header"},rt={class:"card-title"},ct={class:"alert alert-info"},gt={style:{"font-size":"1.05rem","margin-bottom":"0.5rem"}},mt={key:0,class:"card mb-3"},ut={class:"card-header"},_t={class:"card-title"},vt={class:"engagement-grid"},ht={class:"engagement-card"},ft={class:"engagement-card-header"},bt={class:"engagement-card-body"},pt={class:"engagement-metric"},yt={class:"metric-value"},Ct={class:"engagement-detail"},At={class:"detail-value"},kt={class:"engagement-card"},St={class:"engagement-card-header"},Dt={class:"engagement-card-body"},wt={class:"engagement-metric"},Rt={class:"metric-value"},It={class:"engagement-detail"},Pt={class:"detail-value"},Tt={class:"engagement-card"},qt={class:"engagement-card-header"},Lt={class:"engagement-card-body"},zt={class:"engagement-metric"},xt={class:"metric-value"},Bt={key:0,class:"engagement-detail"},Et={class:"detail-value"},Ft={class:"engagement-card"},Nt={class:"engagement-card-header"},Mt={class:"engagement-card-body"},Ot={class:"engagement-metric"},Vt={class:"metric-value"},Gt={class:"engagement-detail"},jt={class:"detail-value"},Ht={key:0,class:"engagement-details-section"},Kt={class:"section-subtitle"},Ut={class:"engaged-students-list"},Yt={class:"student-info"},Jt={class:"student-activity"},Qt={class:"student-frequency"},Wt={class:"frequency-bar"},Xt={class:"frequency-text"},Zt={class:"grid grid-2 mb-3"},$t={class:"card"},te={class:"card-header"},ee={class:"card-title"},se={class:"card"},ne={class:"card-header"},ae={class:"card-title"},le={class:"card mb-3"},oe={class:"card-header"},ie={class:"card-title"},de={class:"badge badge-danger"},re={key:0,class:"empty-state"},ce={key:1,class:"table-container"},ge={class:"table"},me={class:"progress-bar-container"},ue={class:"progress-text"},_e={class:"skills-tags"},ve={key:0,class:"skill-tag"},he={class:"card"},fe={class:"card-header"},be={class:"card-title"},pe={class:"table-container"},ye={class:"table"},Ce={class:"badge badge-info"},Ae={class:"progress-bar-container"},ke={class:"progress-text"},Se={key:0,class:"ai-assistant-panel"},De={key:0,class:"toggle-label"};function we(w,e,v,n,x,B){var o,g,A,I,m,u,_,P,T,y,C;const R=h("LoadingSpinner"),b=h("StatCard"),r=h("Icon"),p=h("router-link"),E=h("LineChart"),F=h("BarChart"),N=h("AIAssistant");return i(),d("div",at,[e[26]||(e[26]=t("div",{class:"page-header"},[t("div",null,[t("h1",null,"Analytics Dashboard"),t("p",null,"AI-driven insights into student performance and engagement")])],-1)),n.loading?(i(),O(R,{key:0,message:"Analyzing data..."})):(i(),d("div",lt,[t("div",ot,[l(b,{icon:"users",value:n.stats.totalStudents,label:"Total Students",iconBg:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},null,8,["value"]),l(b,{icon:"book",value:n.stats.totalContent,label:"Content Items",iconBg:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"},null,8,["value"]),l(b,{icon:"activity",value:n.stats.totalActivities,label:"Total Activities",iconBg:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"},null,8,["value"]),l(b,{icon:"lightning",value:`${n.stats.avgEngagementRate}%`,label:"Avg Engagement",iconBg:"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"},null,8,["value"])]),t("div",it,[t("div",dt,[t("h3",rt,[l(r,{name:"brain"}),e[1]||(e[1]=c(" AI-Generated Insights",-1))])]),t("div",ct,[l(r,{name:"info",size:"1.5rem"}),t("div",null,[t("p",gt,a(n.aiInsight),1),e[2]||(e[2]=t("p",{style:{"font-size":"0.9rem",color:"var(--info)",margin:"0"}}," Recommendation: Review at-risk students below and consider personalized interventions. ",-1))])])]),n.engagementData?(i(),d("div",mt,[t("div",ut,[t("h3",_t,[l(r,{name:"activity"}),e[3]||(e[3]=c(" Engagement Overview",-1))]),l(p,{to:"/reports",class:"btn btn-small btn-primary"},{default:D(()=>[...e[4]||(e[4]=[c("View Full Report",-1)])]),_:1})]),t("div",vt,[t("div",ht,[t("div",ft,[l(r,{name:"users",size:"1.5rem",class:"engagement-icon",style:{color:"#667eea"}}),e[5]||(e[5]=t("h4",null,"Active Students",-1))]),t("div",bt,[t("div",pt,[t("span",yt,a(((o=n.engagementData.sessionFrequency)==null?void 0:o.length)||0),1),e[6]||(e[6]=t("span",{class:"metric-label"},"students engaged",-1))]),t("div",Ct,[e[7]||(e[7]=t("span",{class:"detail-label"},"Avg Activity Rate:",-1)),t("span",At,a(Math.round(((g=n.engagementData.sessionFrequency)==null?void 0:g.reduce((s,k)=>s+k.frequencyPercentage,0))/(((A=n.engagementData.sessionFrequency)==null?void 0:A.length)||1)))+"% ",1)])])]),t("div",kt,[t("div",St,[l(r,{name:"trending-up",size:"1.5rem",class:"engagement-icon",style:{color:"#43e97b"}}),e[8]||(e[8]=t("h4",null,"Top Streaks",-1))]),t("div",Dt,[t("div",wt,[t("span",Rt,a(((m=(I=n.engagementData.streaks)==null?void 0:I[0])==null?void 0:m.currentStreak)||0),1),e[9]||(e[9]=t("span",{class:"metric-label"},"days (longest streak)",-1))]),t("div",It,[e[10]||(e[10]=t("span",{class:"detail-label"},"Student:",-1)),t("span",Pt,a(((_=(u=n.engagementData.streaks)==null?void 0:u[0])==null?void 0:_.studentName)||"N/A"),1)])])]),t("div",Tt,[t("div",qt,[l(r,{name:"alert",size:"1.5rem",class:"engagement-icon",style:{color:"#f59e0b"}}),e[11]||(e[11]=t("h4",null,"Drop-off Points",-1))]),t("div",Lt,[t("div",zt,[t("span",xt,a(((P=n.engagementData.dropOffPoints)==null?void 0:P.length)||0),1),e[12]||(e[12]=t("span",{class:"metric-label"},"identified points",-1))]),n.engagementData.dropOffPoints&&n.engagementData.dropOffPoints.length>0?(i(),d("div",Bt,[e[13]||(e[13]=t("span",{class:"detail-label"},"Highest:",-1)),t("span",Et,a(n.engagementData.dropOffPoints[0].dropOffPercentage)+"% drop",1)])):S("",!0)])]),t("div",Ft,[t("div",Nt,[l(r,{name:"clock",size:"1.5rem",class:"engagement-icon",style:{color:"#3b82f6"}}),e[14]||(e[14]=t("h4",null,"Time Efficiency",-1))]),t("div",Mt,[t("div",Ot,[t("span",Vt,a(((T=n.engagementData.timeComparison)==null?void 0:T.filter(s=>s.timeRatio<=1.2&&s.timeRatio>=.8).length)||0),1),e[15]||(e[15]=t("span",{class:"metric-label"},"lessons on pace",-1))]),t("div",Gt,[e[16]||(e[16]=t("span",{class:"detail-label"},"Total Lessons:",-1)),t("span",jt,a(((y=n.engagementData.timeComparison)==null?void 0:y.length)||0),1)])])])]),n.engagementData.sessionFrequency?(i(),d("div",Ht,[t("h4",Kt,[l(r,{name:"star"}),e[17]||(e[17]=c(" Most Consistent Students",-1))]),t("div",Ut,[(i(!0),d(q,null,L((C=n.engagementData.sessionFrequency)==null?void 0:C.slice(0,5),s=>(i(),d("div",{key:s.studentId,class:"engaged-student-item"},[t("div",Yt,[l(p,{to:`/students/${s.studentId}`,class:"student-name"},{default:D(()=>[c(a(s.studentName),1)]),_:2},1032,["to"]),t("span",Jt,a(s.activeDays)+" days active",1)]),t("div",Qt,[t("div",Wt,[t("div",{class:"frequency-fill",style:M({width:s.frequencyPercentage+"%"})},null,4)]),t("span",Xt,a(s.frequencyPercentage)+"%",1)])]))),128))])])):S("",!0)])):S("",!0),t("div",Zt,[t("div",$t,[t("div",te,[t("h3",ee,[l(r,{name:"trending-up"}),e[18]||(e[18]=c(" Activity Trends (Last 7 Days)",-1))])]),l(E,{data:n.trendsChartData},null,8,["data"])]),t("div",se,[t("div",ne,[t("h3",ae,[l(r,{name:"chart"}),e[19]||(e[19]=c(" Completion Rates",-1))])]),l(F,{data:n.completionChartData},null,8,["data"])])]),t("div",le,[t("div",oe,[t("h3",ie,[l(r,{name:"warning"}),e[20]||(e[20]=c(" At-Risk Students",-1))]),t("span",de,a(n.atRiskStudents.length)+" students",1)]),n.atRiskStudents.length===0?(i(),d("div",re,[t("p",null,[l(r,{name:"check"}),e[21]||(e[21]=c(" No students at risk currently!",-1))])])):(i(),d("div",ce,[t("table",ge,[e[23]||(e[23]=t("thead",null,[t("tr",null,[t("th",null,"Student"),t("th",null,"Grade & Class"),t("th",null,"Risk Level"),t("th",null,"Reason"),t("th",null,"Pass Probability"),t("th",null,"Missing Skills"),t("th",null,"Action")])],-1)),t("tbody",null,[(i(!0),d(q,null,L(n.atRiskStudents,s=>(i(),d("tr",{key:s.student.id},[t("td",null,[l(p,{to:`/students/${s.student.id}`,style:{color:"var(--primary)","font-weight":"600"}},{default:D(()=>[c(a(s.student.name),1)]),_:2},1032,["to"])]),t("td",null,a(s.student.grade)+" - "+a(s.student.class),1),t("td",null,[t("span",{class:z(["badge",s.riskLevel==="high"?"badge-danger":"badge-warning"])},a(s.riskLevel),3)]),t("td",null,a(s.reason),1),t("td",null,[t("div",me,[t("div",{class:"progress-bar",style:M({width:s.passProbability+"%",background:n.getProgressColor(s.passProbability)})},null,4),t("span",ue,a(Math.round(s.passProbability))+"%",1)])]),t("td",null,[t("div",_e,[(i(!0),d(q,null,L(s.missingSkills.slice(0,2),(k,G)=>(i(),d("span",{key:G,class:"skill-tag"},a(k),1))),128)),s.missingSkills.length>2?(i(),d("span",ve," +"+a(s.missingSkills.length-2),1)):S("",!0)])]),t("td",null,[l(p,{to:`/students/${s.student.id}`,class:"btn btn-small btn-primary"},{default:D(()=>[...e[22]||(e[22]=[c(" View Details ",-1)])]),_:1},8,["to"])])]))),128))])])]))]),t("div",he,[t("div",fe,[t("h3",be,[l(r,{name:"book"}),e[24]||(e[24]=c(" Content Performance",-1))])]),t("div",pe,[t("table",ye,[e[25]||(e[25]=t("thead",null,[t("tr",null,[t("th",null,"Content Title"),t("th",null,"Type"),t("th",null,"Difficulty"),t("th",null,"Views"),t("th",null,"Avg Time"),t("th",null,"Completion Rate"),t("th",null,"Performance")])],-1)),t("tbody",null,[(i(!0),d(q,null,L(n.contentPerformance,s=>(i(),d("tr",{key:s.id},[t("td",null,[t("strong",null,a(s.title),1)]),t("td",null,[t("span",Ce,a(s.type),1)]),t("td",null,[t("span",{class:z(["badge",n.getDifficultyClass(s.difficulty)])},a(s.difficulty),3)]),t("td",null,a(s.views),1),t("td",null,a(s.avgTime)+" min",1),t("td",null,[t("div",Ae,[t("div",{class:"progress-bar",style:M({width:s.completionRate+"%",background:n.getProgressColor(s.completionRate)})},null,4),t("span",ke,a(s.completionRate)+"%",1)])]),t("td",null,[t("span",{class:z(["badge",n.getPerformanceClass(s.performance)])},a(s.performance),3)])]))),128))])])])])])),l(K,{name:"slide-in"},{default:D(()=>[n.showAIAssistant?(i(),d("div",Se,[l(N)])):S("",!0)]),_:1}),t("button",{class:z(["ai-assistant-toggle",{active:n.showAIAssistant}]),onClick:e[0]||(e[0]=s=>n.showAIAssistant=!n.showAIAssistant)},[l(r,{name:"brain",size:"1.5rem"}),n.showAIAssistant?(i(),O(r,{key:1,name:"x",size:"1.2rem",class:"close-icon"})):(i(),d("span",De,"AI Assistant"))],2)])}const Be=j(nt,[["render",we],["__scopeId","data-v-979aee2d"]]);export{Be as default};
