import{d as E,g as S,S as v,A as k,c as D,h as N,i as T,j as I}from"./api-D1efx5EC.js";async function K(){await E(800);const i=S(v.STUDENTS)||[],l=S(v.CONTENT)||[],s=S(v.EVENTS)||[],n=i.length,t=l.length,e=s.length,o=new Set(s.map(p=>p.studentId)).size,r=n>0?Math.round(o/n*100):0,c=s.filter(p=>p.completed).length,d=e>0?Math.round(c/e*100):0,g=A(s,7),a=s.sort((p,M)=>new Date(M.timestamp)-new Date(p.timestamp)).slice(0,10).map(p=>{const M=i.find(f=>f.id===p.studentId),w=l.find(f=>f.id===p.contentId);return{...p,studentName:(M==null?void 0:M.name)||"Unknown",contentTitle:(w==null?void 0:w.title)||"Unknown"}}),u=P(i,s,l),m=new k({totalStudents:n,totalContent:t,totalActivities:e,avgEngagementRate:r,avgCompletionRate:d,trends:g});return D({summary:m,recentActivities:a,atRiskStudents:u,aiInsight:T(I.general)})}async function W(i){await E(600);const l=S(v.STUDENTS)||[],s=S(v.CONTENT)||[],n=S(v.EVENTS)||[],t=l.find(f=>f.id===i);if(!t)return D(null,!1,"Student not found");const e=n.filter(f=>f.studentId===i),o=Math.round(e.reduce((f,h)=>f+h.durationMs/6e4,0)),r=e.filter(f=>f.completed).length,c=e.filter(f=>f.score!==null),d=c.length>0?Math.round(c.reduce((f,h)=>f+h.score,0)/c.length):0,g=R(e,s),a=C(g,d,e),u=e.sort((f,h)=>new Date(h.timestamp)-new Date(f.timestamp)).map(f=>{const h=s.find(y=>y.id===f.contentId);return{...f,contentTitle:(h==null?void 0:h.title)||"Unknown",contentType:(h==null?void 0:h.type)||"unknown",timeMinutes:Math.round(f.durationMs/6e4)}}),{strengths:m,improvements:p}=O(e,s,d),M=z(t,d,g),w=new N({studentId:i,totalTimeMinutes:o,completedContent:r,avgScore:d,engagementScore:g,riskLevel:a,activityLog:u,strengths:m,improvements:p,aiInsight:M});return D({student:t,analytics:w})}function A(i,l){const s=[],n=new Date;for(let t=l-1;t>=0;t--){const e=new Date(n);e.setDate(e.getDate()-t),e.setHours(0,0,0,0);const o=new Date(e);o.setDate(o.getDate()+1);const r=i.filter(c=>{const d=new Date(c.timestamp);return d>=e&&d<o});s.push({date:e.toISOString().split("T")[0],activities:r.length,completions:r.filter(c=>c.completed).length,uniqueStudents:new Set(r.map(c=>c.studentId)).size})}return s}function R(i,l){if(i.length===0)return 0;const s=i.filter(r=>(Date.now()-new Date(r.timestamp))/864e5<=7),n=Math.min(s.length/5*100,100),t=i.filter(r=>r.completed).length/i.length*100,o=new Set(i.map(r=>r.contentId)).size/Math.max(l.length,1)*100;return Math.round(n*.4+t*.4+o*.2)}function C(i,l,s){return s.filter(t=>(Date.now()-new Date(t.timestamp))/864e5<=7).length===0||i<40||l<50?"high":i<65||l<70?"medium":"low"}function O(i,l,s){const n=[],t=[],e={};return i.forEach(o=>{const r=l.find(c=>c.id===o.contentId);r&&(e[r.difficulty]||(e[r.difficulty]=[]),o.score!==null&&e[r.difficulty].push(o.score))}),Object.entries(e).forEach(([o,r])=>{if(r.length===0)return;const c=r.reduce((d,g)=>d+g,0)/r.length;c>=80?n.push(`${o.charAt(0).toUpperCase()+o.slice(1)} level content`):c<60&&t.push(`${o.charAt(0).toUpperCase()+o.slice(1)} level content`)}),n.length===0&&s>=70&&n.push("Consistent completion rate"),t.length===0&&s<70&&t.push("Time management","Content comprehension"),{strengths:n,improvements:t}}function z(i,l,s,n,t){let e;return l>=80&&s>=75?e=T(I.student.low_risk):l<60||s<50?e=T(I.student.high_risk):e=T(I.student.medium_risk),e.replace("{name}",i.name)}function P(i,l,s){return i.map(n=>{const t=l.filter(a=>a.studentId===n.id);if(t.length===0)return{student:n,riskLevel:"high",reason:"No activity recorded",missingSkills:["Getting started"]};const e=R(t,s),o=t.filter(a=>a.score!==null),r=o.length>0?o.reduce((a,u)=>a+u.score,0)/o.length:0,c=C(e,r,t);if(c==="low")return null;let d="";const g=[];return e<40?d="Low engagement":r<60?(d="Low performance scores",t.filter(u=>u.score!==null&&u.score<60).map(u=>s.find(m=>m.id===u.contentId)).filter(u=>u).forEach(u=>{g.push(...u.skills)})):d="Inconsistent completion",{student:n,riskLevel:c,reason:d,missingSkills:[...new Set(g)].slice(0,3),passProbability:Math.max(0,Math.min(100,e*.5+r*.5))}}).filter(Boolean)}async function Y(){await E(700);const i=S(v.STUDENTS)||[],l=S(v.CONTENT)||[],s=S(v.EVENTS)||[],n=L(s,l),t=_(s,i),e=x(s,l),o=U(s,l),r=b(s,i);return D({timePerLesson:n,sessionFrequency:t,dropOffPoints:e,timeComparison:o,streaks:r})}function L(i,l,s){const n={};return l.forEach(t=>{const e=i.filter(c=>c.contentId===t.id),o=e.reduce((c,d)=>c+d.durationMs/6e4,0),r=e.length>0?o/e.length:0;n[t.id]={contentId:t.id,title:t.title,avgTimeMinutes:Math.round(r),estimatedMinutes:t.estimatedMinutes,studentCount:new Set(e.map(c=>c.studentId)).size,completionRate:e.length>0?Math.round(e.filter(c=>c.completed).length/e.length*100):0}}),Object.values(n).sort((t,e)=>e.avgTimeMinutes-t.avgTimeMinutes)}function _(i,l){return l.map(s=>{const n=i.filter(c=>c.studentId===s.id),t=new Set(n.map(c=>new Date(c.timestamp).toISOString().split("T")[0]));if(n.length===0)return{studentId:s.id,studentName:s.name,activeDays:0,totalDays:0,frequencyPercentage:0};const e=new Date(Math.min(...n.map(c=>new Date(c.timestamp)))),o=new Date(Math.max(...n.map(c=>new Date(c.timestamp)))),r=Math.ceil((o-e)/(1e3*60*60*24))+1;return{studentId:s.id,studentName:s.name,activeDays:t.size,totalDays:r,frequencyPercentage:r>0?Math.round(t.size/r*100):0}})}function x(i,l){const s=l.sort((t,e)=>t.courseId!==e.courseId?t.courseId.localeCompare(e.courseId):t.order-e.order),n=[];for(let t=0;t<s.length-1;t++){const e=s[t],o=s[t+1];if(e.courseId!==o.courseId)continue;const r=new Set(i.filter(a=>a.contentId===e.id).map(a=>a.studentId)),c=new Set(i.filter(a=>a.contentId===o.id).map(a=>a.studentId)),d=r.size-c.size,g=r.size>0?Math.round(d/r.size*100):0;g>20&&n.push({fromContent:e.title,toContent:o.title,dropOffCount:d,dropOffRate:g,courseId:e.courseId})}return n.sort((t,e)=>e.dropOffRate-t.dropOffRate)}function U(i,l){return l.map(s=>{const n=i.filter(o=>o.contentId===s.id&&o.completed);if(n.length===0)return null;const t=n.reduce((o,r)=>o+r.durationMs/6e4,0)/n.length,e=t/s.estimatedMinutes;return{contentId:s.id,title:s.title,estimatedMinutes:s.estimatedMinutes,actualMinutes:Math.round(t),ratio:Math.round(e*100)/100,status:e>1.5?"too_slow":e<.7?"too_fast":"on_pace"}}).filter(Boolean)}function b(i,l){return l.map(s=>{const n=i.filter(a=>a.studentId===s.id).sort((a,u)=>new Date(a.timestamp)-new Date(u.timestamp));if(n.length===0)return{studentId:s.id,studentName:s.name,currentStreak:0,longestStreak:0,lastActiveDate:null};const t=[...new Set(n.map(a=>new Date(a.timestamp).toISOString().split("T")[0]))].sort();let e=1,o=1,r=1;for(let a=1;a<t.length;a++){const u=new Date(t[a-1]),m=new Date(t[a]);Math.round((m-u)/(1e3*60*60*24))===1?(r++,o=Math.max(o,r)):r=1}const c=new Date(t[t.length-1]),d=new Date;return d.setHours(0,0,0,0),Math.round((d-c)/(1e3*60*60*24))<=1?e=r:e=0,{studentId:s.id,studentName:s.name,currentStreak:e,longestStreak:o,lastActiveDate:c.toISOString().split("T")[0]}})}async function J(){await E(700);const i=S(v.STUDENTS)||[],l=S(v.CONTENT)||[],s=S(v.EVENTS)||[],n=q(s,l),t=B(s,i),e=F(s,i,l),o=V(s);return D({lessonDifficulty:n,strugglingStudents:t,highPerformers:e,performanceTrends:o})}function q(i,l){return l.map(s=>{const n=i.filter(h=>h.contentId===s.id);if(n.length===0)return{contentId:s.id,title:s.title,difficultyScore:0,rating:"no_data"};const t=n.reduce((h,y)=>h+y.durationMs/6e4,0)/n.length,e=t/s.estimatedMinutes,o=n.filter(h=>h.struggledFlag).length/n.length,r=n.filter(h=>h.completed).length/n.length,c=n.reduce((h,y)=>h+(y.pauseCount||0),0)/n.length,d=n.filter(h=>h.score!==null),g=d.length>0?d.reduce((h,y)=>h+y.score,0)/d.length:75,a=Math.min((e-1)*50,50),u=o*30,m=(1-r)*10,p=Math.min(c/10*5,5),M=(100-g)/10,w=Math.round(a+u+m+p+M);let f;return w>=60?f="very_hard":w>=40?f="hard":w>=20?f="moderate":f="easy",{contentId:s.id,title:s.title,difficultyScore:Math.min(w,100),rating:f,metrics:{avgTimeMinutes:Math.round(t),struggleRate:Math.round(o*100),completionRate:Math.round(r*100),avgPauses:Math.round(c),avgScore:Math.round(g)}}}).sort((s,n)=>n.difficultyScore-s.difficultyScore)}function B(i,l,s){return l.map(n=>{const t=i.filter(a=>a.studentId===n.id);if(t.length===0)return null;t.reduce((a,u)=>a+u.durationMs/6e4,0)/t.length;const e=t.filter(a=>a.struggledFlag).length/t.length,o=t.filter(a=>a.completed).length/t.length,r=t.filter(a=>a.attemptNumber>1).length,c=t.filter(a=>a.score!==null),d=c.length>0?c.reduce((a,u)=>a+u.score,0)/c.length:50,g=e*40+(1-o)*30+Math.min(r/t.length,.5)*20+(100-d)/100*10;return g<30?null:{studentId:n.id,studentName:n.name,struggleScore:Math.round(g),indicators:{struggleRate:Math.round(e*100),completionRate:Math.round(o*100),multipleAttempts:r,avgScore:Math.round(d)}}}).filter(Boolean).sort((n,t)=>t.struggleScore-n.struggleScore)}function F(i,l,s){return l.map(n=>{const t=i.filter(m=>m.studentId===n.id);if(t.length<3)return null;const e=t.map(m=>{const p=s.find(M=>M.id===m.contentId);return{event:m,estimated:(p==null?void 0:p.estimatedMinutes)||0}}),o=e.filter(m=>m.estimated>0).reduce((m,p)=>m+p.event.durationMs/6e4/p.estimated,0)/e.length,r=t.filter(m=>m.completed).length/t.length,c=t.filter(m=>m.struggledFlag).length/t.length,d=t.filter(m=>m.attemptNumber===1&&m.completed).length/t.length,g=t.filter(m=>m.score!==null),a=g.length>0?g.reduce((m,p)=>m+p.score,0)/g.length:0,u=a/100*40+r*25+(1-c)*15+d*10+Math.max(0,1-o)*10;return u<70?null:{studentId:n.id,studentName:n.name,performanceScore:Math.round(u),metrics:{avgScore:Math.round(a),completionRate:Math.round(r*100),timeEfficiency:Math.round(1/o*100),firstTryRate:Math.round(d*100)}}}).filter(Boolean).sort((n,t)=>t.performanceScore-n.performanceScore)}function V(i,l){const n=[];for(let t=3;t>=0;t--){const e=new Date;e.setDate(e.getDate()-t*7);const o=new Date(e);o.setDate(o.getDate()-7);const r=i.filter(a=>{const u=new Date(a.timestamp);return u>=o&&u<e}),c=r.filter(a=>a.score!==null),d=c.length>0?c.reduce((a,u)=>a+u.score,0)/c.length:0,g=r.length>0?r.filter(a=>a.completed).length/r.length*100:0;n.push({week:`Week ${4-t}`,startDate:o.toISOString().split("T")[0],endDate:e.toISOString().split("T")[0],avgScore:Math.round(d),completionRate:Math.round(g),activeStudents:new Set(r.map(a=>a.studentId)).size})}return n}async function Q(){await E(700);const i=S(v.STUDENTS)||[],l=S(v.CONTENT)||[],s=S(v.EVENTS)||[],n=G(s,l),t=$(s,l),e=j(s,i);return D({slowdownLessons:n,bestContent:t,laggingGroups:e})}function G(i,l){return l.map(n=>{const t=i.filter(g=>g.contentId===n.id);if(t.length<3)return null;const e=t.reduce((g,a)=>g+a.durationMs/6e4,0)/t.length,o=e/n.estimatedMinutes,r=new Set(t.map(g=>g.studentId)).size,c=t.filter(g=>g.durationMs/6e4/n.estimatedMinutes>1.5).length,d=t.length>0?c/t.length*100:0;return d<40?null:{contentId:n.id,title:n.title,estimatedMinutes:n.estimatedMinutes,actualMinutes:Math.round(e),slowdownRate:Math.round(d),affectedStudents:r,timeRatio:Math.round(o*100)/100}}).filter(Boolean).sort((n,t)=>t.slowdownRate-n.slowdownRate).slice(0,10)}function $(i,l){return l.map(n=>{const t=i.filter(u=>u.contentId===n.id);if(t.length<3)return null;const e=t.filter(u=>u.completed).length/t.length*100,o=t.filter(u=>u.score!==null),r=o.length>0?o.reduce((u,m)=>u+m.score,0)/o.length:0,d=t.reduce((u,m)=>u+m.durationMs/6e4,0)/t.length/n.estimatedMinutes,g=t.filter(u=>u.struggledFlag).length/t.length,a=(e/100*30+r/100*30+Math.max(0,1-Math.abs(d-1))*25+(1-g)*15)*100;return a<70?null:{contentId:n.id,title:n.title,type:n.type,performanceScore:Math.round(a),metrics:{completionRate:Math.round(e),avgScore:Math.round(r),engagementCount:t.length,timeEfficiency:Math.round(1/d*100)}}}).filter(Boolean).sort((n,t)=>t.performanceScore-n.performanceScore).slice(0,10)}function j(i,l,s){const n={};return l.forEach(e=>{const o=`${e.grade}-${e.class}`;n[o]||(n[o]={grade:e.grade,class:e.class,students:[],events:[]}),n[o].students.push(e),n[o].events.push(...i.filter(r=>r.studentId===e.id))}),Object.values(n).map(e=>{if(e.events.length===0)return{grade:e.grade,class:e.class,studentCount:e.students.length,avgScore:0,completionRate:0,engagementRate:0,status:"no_data"};const o=e.events.filter(u=>u.score!==null),r=o.length>0?o.reduce((u,m)=>u+m.score,0)/o.length:0,c=e.events.filter(u=>u.completed).length/e.events.length*100,g=new Set(e.events.map(u=>u.studentId)).size/e.students.length*100;let a="on_track";return(r<65||c<60||g<70)&&(a="lagging"),{grade:e.grade,class:e.class,studentCount:e.students.length,avgScore:Math.round(r),completionRate:Math.round(c),engagementRate:Math.round(g),status:a}}).sort((e,o)=>e.avgScore-o.avgScore)}export{Y as a,J as b,Q as c,W as d,K as g};
